---
import fs from "node:fs";
import buildScript from "./script.js";

export interface props {
  limit: number;
  origins: string[];
  external: boolean;
  ignores: string[];
  isHighPriority: boolean;
  root: string;
  rootMargin: string;
  threshold: number;
  timeout: number;
  delay: number;
}

const {
  limit,
  origins,
  external = false,
  ignores,
  isHighPriority = false,
  root = null,
  rootMargin = null;
  threshold = 0.25,
  timeout = 2000,
  delay = 500,
} = Astro.props;

const scriptContent = buildScript(
  limit,
  origins,
  external,
  ignores,
  isHighPriority,
  root,
  rootMargin,
  threshold,
  timeout,
  delay
);

fs.writeFileSync("node_modules/astro-spa/spa.js", scriptContent);

const script = `<script${external ? ` src="node_modules/astro-spa/spa.js"` : ""}>${
  external ? "" : scriptContent
}</script>`;
---

{script}